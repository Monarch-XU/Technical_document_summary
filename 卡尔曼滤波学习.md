# 卡尔曼滤波学习

## 概况

用于预测线性变化的变量的方法。可以用于预测物体在下一时刻的位置与速度。

卡尔曼滤波的局限性在于其只能拟合**线性高斯系统**。但其最大的优点在于计算量小，能够利用前一时刻的状态（和可能的测量值）来得到当前时刻下的状态的最优估计。

## 储备知识

### 高斯分布

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/2fab8c41ed947b9af9df0a6beed662c6.png)
$$
f(x|\mu,\sigma^2) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}
$$

也被称为正态分布或钟形曲。

- ( $x$ ) 是变量
- ( $\mu$ ) 是分布的均值（mean）
- ( $\sigma$) 是标准差（standard deviation）
- ( $\sigma^2$ ) 是方差（variance）

1. **形状**：高斯分布呈现一个钟形曲线，其中最高点对应于均值 ( $\mu$ )。两侧关于 ( $\mu$ ) 对称。
2. **均值、中位数、众数**：对于正态分布，均值、中位数和众数都是相同的，并且位于分布的中心。
3. **68-95-99.7规则**：对于一个标准的正态分布（均值为0，标准差为1）：

- 约68%的数据落在均值的±1个标准差之内。
- 约95%的数据落在均值的±2个标准差之内。
- 约99.7%的数据落在均值的±3个标准差之内。



## 卡尔曼滤波

假设一辆车在路上开，用位置和速度来标志它的状态：
$$
x_t = 
\left|\begin{matrix}      
P_t\\
v_t
\end{matrix}\right|
$$

P~t~表示位置，v~t~表示速度。同时外加一控制量u~t~，表示加速度。

设P~t-1~为上一时刻的位置，如果想通过上一时刻的位置来预测这一时刻的位置，可以使用公式
$x=x_0+v_0\Delta t+\frac{1}{2}at^2$
，即

$$
P_t = P_t-1+v_{t-1}\Delta t+\frac{1}{2}u_t{\Delta t}^2\\
同时，速度v_t=v_{t-1}+u_t\Delta t
$$

由于是线性关系，可以写成矩阵形式：

$$
状态转移方程：
\left|\begin{matrix}
P_t\\
v_t
\end{matrix}\right|
=
\left|\begin{matrix}
1&\Delta t\\
0&1
\end{matrix}\right|
\left|\begin{matrix}
P_{t-1}\\
v_{t-1}
\end{matrix}\right|
+
\left|\begin{matrix}
\frac{{\Delta t}^2}{2}\\
\Delta t
\end{matrix}\right|
u_t\\
$$

这个方程叫**状态转移方程**，也可以简写成：

$$
状态预测公式：\hat{x_t}^- = F_t\hat{x_{t-1}}+B_tu_t
$$

这就是**状态预测公式**。其中
$F_t = \left|\begin{matrix}
1&\Delta t\\
0&1
\end{matrix}\right|$
叫做状态转移矩阵，它表示我们如何从上一时刻的状态推测这一时刻的状态。
$B_t=\left|\begin{matrix}
\frac{{\Delta t}^2}{2}\\
\Delta t
\end{matrix}\right|$
叫做控制矩阵，他表示控制量$u$如何作用于当前状态。其中$\hat{x_t}^-$表示估计量，减号角标表示由上一时刻预测而来。

然而，预测是有噪声的，也就是不可控的随机性因素，这会随机扰乱我们的预测结果。我们需要**协方差矩阵**来修正。它是有关不确定性的表述。

假设我们有一个一维的，包含噪声的数据，每次测量的值都不同，但都是围绕在一个中心值的周围。表示它分布状况的最简单的方法就是记下它的中心值和方差，如图：

![img](https://pic3.zhimg.com/80/v2-37e04458baf17d09c914981b5dbae140_1440w.webp)

如果是一个二维包含噪声的数据，那就分别对两个坐标轴进行投影，在两个轴上都是高斯分布，那我们在表示它的分布的时候分别记下来两个高斯分布的中心值和方差即可。如果两个维度的噪声是独立的时候可以这么表示：

![img](https://i-blog.csdnimg.cn/blog_migrate/1b8c9d5e06a6ec00b2649f7c67c4a46a.png)

但是如果两个维度有相关性的情况，比如在一个维度上噪声增大的时候，另一个维度噪声也增大，就是这样：

![img](https://i-blog.csdnimg.cn/blog_migrate/6c131720deeec115456bfe80a95691f5.png)

如果一个维度增大的时候，另一个维度减小，就会变成这样：

![img](https://i-blog.csdnimg.cn/blog_migrate/c44366db97d1ecd1ef2d5083bf14f80b.png)

这时候在两个坐标轴上投影跟第一个是完全没有变化，仍然是高斯分布，所以为了表示这两个维度之间的相关性，除了要记住两个维度的方差之外，还要有一个斜方差来表示两个维度之间的相关程度。把他们写成一个矩阵的形式呢，就是这样子。

$$
cov(x,x) = 
\left|\begin{matrix}
\sigma_{11}&\sigma_{12}\\
\sigma_{12}&\sigma_{22}
\end{matrix}\right|
$$


对角线上的两个值是两个维度的方差。反对角线上的两个值是相等的，是他们的斜方差。在这三种情况中，第一种的斜方差等于零。第二种的前方差为正，第三种的呈负相关的趋势，斜方差就为负。在卡尔曼滤波器中所有关于不确定性的表述都要用到斜方差矩阵。

 
